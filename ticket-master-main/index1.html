<!DOCTYPE html>
<html>

<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="user-scalable=0">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="stylesheet" href="style.css">
    <script>
        const linkElement = document.createElement('link');
        linkElement.rel = 'stylesheet';
        linkElement.type = 'text/css';
        const timestamp = new Date().getTime();
        const updatedCssUrl = `color.css?t=${timestamp}`;
        linkElement.href = updatedCssUrl;
        document.head.appendChild(linkElement);
    </script>
    <script>
        function openPopup() {
            document.getElementById('popupModal').style.display = 'block';
        }
    
        function closePopup() {
            document.getElementById('popupModal').style.display = 'none';
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        function generateQRCode(link) {
            const qrCodeContainer = document.querySelector('.qr-square img');
            QRCode.toDataURL(link, { width: 362.59, margin: 0.1, errorCorrectionLevel: 'H' }, function (err, url) { 
                // Adjusted errorCorrectionLevel to 'H' for better error correction
                if (!err) {
                    qrCodeContainer.src = url;
                    const popupImage = document.querySelector('#popupModal img');
                    popupImage.src = url;
                } else {
                    console.error('Error generating QR code:', err);
                }
            });
        }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .qr-square {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            width: 400px; /* Container width slightly larger than QR code */
            margin: auto;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }

        .qr-square img {
            padding: 10px;
            background: white;
            border-radius: 5px;
            width: 362.59px;
            height: 362.59px;
            object-fit: contain;
        }

        #popupModal img {
            width: 362.59px;
            height: 362.59px;
            object-fit: contain;
            border-radius: 5px;
        }
    </style>
</head>
<body style="margin: 0;">
    <div class="container">
        <div class="square">
            <div class="square-text" id="pass_month_year">
                
            </div>
        </div>
        <div class="qr-square">
            <a href="#" onclick="openPopup(); return false;">
                <img class="qr-code" src="" alt="QR Code"> <!-- Styling handled in CSS -->
            </a>
            <div class="tap-to-enlarge">Tap to enlarge</div>
        </div>
    </div>
    <div class="bip">BUS INTERSTATE PASS</div>
    <div class="rectangle">
        <div class="rectangle-text1" onclick="updateZoneText()">2</div>
        <div class="rectangle-text2">ZONES</div>
    </div>
    <div class="bottom-container">
        <div class="datetime" id="datetime"></div>
        <div class="color-strip">
            <div class="color-block red"></div>
            <div class="color-block green"></div>
            <div class="color-block blue"></div>
        </div>
        <div class="expires-text">Expires in <span id="countdown"></span></div>
        <img class="bottom-image" src="bottom.png" alt="Bottom Image">
        
        <div id="popupModal" style="position: fixed;top: 19%;left: 52%;transform: translate(-50%, -50%);width: 100%;background-color: rgb(255, 255, 255);border: 2px solid rgb(204, 204, 204);box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 10px;padding: 20px 20px 20px 487px;height: 142%;display: none;">
                <img onclick="closePopup()" src="" alt="QR Code" style="width: 362.59px; height: 362.59px; object-fit: contain;padding-top: 130%;margin-bottom: 65px;"> <!-- Popup size -->
                <a class="back-font">Tap to go back</a>
        </div>
    </div>
    <script>
        function updateMonthAndYear() {
            var currentDate = new Date();
            var monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            var month = monthNames[currentDate.getMonth()];
            var year = currentDate.getFullYear();
            var student = "STUDENT";
            var content = month + "<br>" + year + "<br>" + student;
            document.getElementById("pass_month_year").innerHTML = content;
        }

        function updateCountdown() {
            const countdown = document.getElementById('countdown');
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const deadlineDate = new Date(currentDate.getFullYear(), currentMonth + 1, 1, 0, 0, 0); // Deadline is set for the start of next month

            const timeRemaining = new Date(deadlineDate - currentDate);

            const days = timeRemaining.getUTCDate() - 1;
            const hours = timeRemaining.getUTCHours();
            const minutes = timeRemaining.getUTCMinutes();
            const seconds = timeRemaining.getUTCSeconds();

            countdown.textContent = `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateDateTime() {
            const datetime = document.getElementById('datetime');
            const currentDate = new Date();
            const options = {
                weekday: 'short',
                month: 'short',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const dateTimeString = currentDate.toLocaleString('en-US', options);
            datetime.textContent = dateTimeString.replace(" at", " ");
        }
        function updateZoneText() {
            const zoneElement = document.querySelector('.rectangle-text1');
            let currentZone = parseInt(zoneElement.textContent, 10);
            currentZone = currentZone === 8 ? 2  : currentZone + 1;
            zoneElement.textContent = currentZone;
        }
        updateMonthAndYear();
        updateCountdown();
        updateDateTime();
        setInterval(updateCountdown, 1000);
        setInterval(updateDateTime, 1000);
        const dailyLink = "https://njticket-public.vercel.app"; // Replace this with the daily link
        generateQRCode(dailyLink);
    </script>

</body>
</html>